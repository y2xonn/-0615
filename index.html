<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI 맞춤형 SNS</title>
  <style>
    :root {
      --primary: #1da1f2;
      --bg: #f5f8fa;
      --card: #ffffff;
      --border: #e6ecf0;
      --text: #14171a;
      --subtext: #657786;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background: var(--bg);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }

    /* ===== AUTH SECTION ===== */
    #auth-section {
      width: 100%;
      max-width: 400px;
      background: var(--card);
      padding: 32px 40px;
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.4s ease;
    }
    #auth-section h1 {
      margin: 0 0 24px 0;
      font-size: 28px;
      text-align: center;
      color: var(--text);
    }
    .input {
      width: 100%;
      padding: 12px 14px;
      margin-top: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
    }
    .btn {
      width: 100%;
      padding: 12px 14px;
      margin-top: 20px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 9999px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #0d8de1;
    }
    .switch-auth {
      margin-top: 16px;
      text-align: center;
      color: var(--subtext);
      font-size: 14px;
    }
    .switch-auth span {
      color: var(--primary);
      cursor: pointer;
    }

    /* ===== INTEREST SECTION ===== */
    #interest-section {
      display: none;
      width: 100%;
      max-width: 400px;
      background: var(--card);
      padding: 32px 40px;
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.4s ease;
    }
    #interest-section h2 {
      margin: 0 0 24px 0;
      text-align: center;
      color: var(--text);
    }

    /* ===== FEED SECTION ===== */
    #feed-section {
      display: none;
      width: 100%;
      max-width: 600px;
      animation: fadeIn 0.4s ease;
    }
    #search-bar {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 9999px;
      font-size: 15px;
      margin-bottom: 16px;
    }
    .tweet {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px 20px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .tweet-user {
      font-weight: 600;
      color: var(--text);
    }
    .tweet-content {
      color: var(--text);
      line-height: 1.4;
    }
    .tweet-time {
      font-size: 13px;
      color: var(--subtext);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- ===== AUTH SECTION ===== -->
  <section id="auth-section">
    <h1 id="auth-title">로그인</h1>
    <input id="auth-id" class="input" type="text" placeholder="아이디" />
    <input id="auth-pw" class="input" type="password" placeholder="비밀번호" />
    <button id="auth-btn" class="btn">로그인</button>
    <p class="switch-auth" id="switch-msg">
      계정이 없으신가요? <span id="switch-link">회원가입</span>
    </p>
  </section>

  <!-- ===== INTEREST SECTION ===== -->
  <section id="interest-section">
    <h2>관심사를 입력하세요</h2>
    <input id="interest-input" class="input" type="text" placeholder="예: 블록체인, 축구, K‑드라마" />
    <button id="interest-btn" class="btn">피드로 이동</button>
  </section>

  <!-- ===== FEED SECTION ===== -->
  <section id="feed-section">
    <input id="search-bar" type="text" placeholder="검색..." />
    <div id="tweets"></div>
  </section>

  <script>
    // ===== STATE =====
    let isLoginMode = true;
    let userInterest = "";

    // ===== ELEMENTS =====
    const authSection = document.getElementById("auth-section");
    const authTitle = document.getElementById("auth-title");
    const authBtn = document.getElementById("auth-btn");
    const switchMsg = document.getElementById("switch-msg");
    const switchLink = document.getElementById("switch-link");
    const authId = document.getElementById("auth-id");
    const authPw = document.getElementById("auth-pw");

    const interestSection = document.getElementById("interest-section");
    const interestInput = document.getElementById("interest-input");
    const interestBtn = document.getElementById("interest-btn");

    const feedSection = document.getElementById("feed-section");
    const tweetsDiv = document.getElementById("tweets");
    const searchBar = document.getElementById("search-bar");

    // ===== AUTH HANDLERS =====
    switchLink.addEventListener("click", () => {
      isLoginMode = !isLoginMode;
      authTitle.textContent = isLoginMode ? "로그인" : "회원가입";
      authBtn.textContent = isLoginMode ? "로그인" : "회원가입";
      switchMsg.innerHTML = isLoginMode
        ? '계정이 없으신가요? <span id="switch-link">회원가입</span>'
        : '이미 계정이 있으신가요? <span id="switch-link">로그인</span>';
      // Re‑attach click listener after HTML rewrite
      document.getElementById("switch-link").addEventListener("click", () => {
        switchLink.click();
      });
    });

    authBtn.addEventListener("click", () => {
      const id = authId.value.trim();
      const pw = authPw.value.trim();
      if (!id || !pw) {
        alert("아이디와 비밀번호를 입력하세요.");
        return;
      }
      alert(`${id} 님, ${isLoginMode ? "로그인" : "회원가입"}이 완료되었습니다.`);
      authSection.style.display = "none";
      interestSection.style.display = "block";
    });

    // ===== INTEREST HANDLER =====
    interestBtn.addEventListener("click", () => {
      const interest = interestInput.value.trim();
      if (!interest) {
        alert("관심사를 입력해주세요.");
        return;
      }
      userInterest = interest;
      interestSection.style.display = "none";
      feedSection.style.display = "block";
      tweetsDiv.innerHTML = ""; // 초기화
      generateTweet(userInterest);
    });

    // ===== FEED SEARCH =====
    searchBar.addEventListener("keyup", (e) => {
      if (e.key === "Enter") {
        const query = searchBar.value.trim();
        if (query) {
          generateTweet(query, true);
          searchBar.value = "";
        }
      }
    });

    // ===== AI REQUEST (OpenAI) =====
    async function fetchFromOpenAI(prompt) {
      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer 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", // "TODO: Replace safely in backend
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [
              {
                role: "system",
                content:
                  "너는 익살스럽고 자극적인 가짜 뉴스를 작성하는 기자야. 너무 극단적이거나 혐오적 표현은 피하되, 클릭을 유도할 만한 선정적·과장된 표현을 사용해. 문장은 2~3문장으로 짧게.",
              },
              { role: "user", content: prompt },
            ],
            max_tokens: 120,
            temperature: 0.9,
          }),
        });
        const data = await response.json();
        return data.choices?.[0]?.message?.content || "[AI 생성 실패]";
      } catch (error) {
        console.error("OpenAI Error", error);
        return "[AI 호출 오류]";
      }
    }

    // ===== TWEET RENDERING =====
    async function generateTweet(topic, isSearch = false) {
      const tweetEl = document.createElement("div");
      tweetEl.className = "tweet";
      tweetEl.innerHTML = `<p class="tweet-user">AI 기자</p><p class="tweet-content">생성 중...</p><p class="tweet-time">방금</p>`;
      if (isSearch) {
        tweetsDiv.prepend(tweetEl);
      } else {
        tweetsDiv.appendChild(tweetEl);
      }

      const content = await fetchFromOpenAI(`${topic}에 대한 자극적인 가짜 뉴스 헤드라인을 작성해줘. 한국어로.`);
      tweetEl.querySelector(".tweet-content").textContent = content;
    }
  </script>
</body>
</html>

