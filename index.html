<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>편향 피드 체험</title>
  <style>
    body {font-family: Arial, sans-serif; background: #f4f6f8; margin: 0; padding: 24px; display: flex; justify-content: center;}
    .container {width: 100%; max-width: 780px;}
    h1, h2 {margin-bottom: 20px; color: #333;}
    select, button, textarea {padding: 10px; font-size: 15px; border: 1px solid #ccc; border-radius: 6px;}
    button.action {background: #1d9bf0; color: #fff; border: none; cursor: pointer; margin-left: 8px;}
    .feed-item {background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 18px; margin-bottom: 14px; position: relative;}
    .subtext {font-size: 13px; color: #666; margin-top: 6px;}
    .tag-buttons {position: absolute; top: 18px; right: 18px;}
    .tag-button {padding: 6px 10px; margin-left: 6px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer;}
    .positive {background: #d4edda !important;}
    .negative {background: #f8d7da !important;}
    .hidden {display: none;}
    .explain, .survey {background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 20px; margin-top: 30px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>편향 피드 체험</h1>
    <label>주제 선택:</label>
    <select id="topic-select">
      <option value="환경">환경</option>
      <option value="AI">AI</option>
      <option value="연예인">연예인 A</option>
    </select>
    <button id="generate" class="action">피드 생성</button>

    <div id="feed"></div>
    <button id="result-btn" class="action hidden">결과 보기</button>

    <div id="summary" class="hidden">
      <h2>결과 요약</h2>
      <p id="real"></p>
      <p id="user"></p>
      <button onclick="showExplanation()" class="action">다음으로</button>
    </div>

    <div id="explanation" class="explain hidden">
      <h2>필터버블과 알고리즘 편향이란?</h2>
      <p>필터버블은 알고리즘이 사용자의 관심사에 맞춘 콘텐츠만 보여줘서 다양한 시각을 접하기 어렵게 만드는 현상입니다. 알고리즘 편향은 특정 방향의 정보만 더 자주 노출되는 현상으로, 사용자 인식에 영향을 줄 수 있습니다.</p>
      <h3>이런 문제를 해결하려면?</h3>
      <ul>
        <li>다양한 출처에서 정보를 확인하기</li>
        <li>자신과 다른 시각도 고려하기</li>
        <li>자동 추천에만 의존하지 않기</li>
      </ul>
      <button onclick="showSurvey()" class="action">설문 참여하기</button>
    </div>

    <div id="survey" class="survey hidden">
      <h2>체험 피드백</h2>
      <label for="thoughts">이번 체험에서 느낀 점을 자유롭게 적어주세요:</label><br/>
      <textarea id="thoughts" rows="5" style="width: 100%; margin-top: 10px;"></textarea><br/>
      <button onclick="submitSurvey()" class="action">제출</button>
    </div>
  </div>

<script>
const FEEDS = {
  '환경': {
    positive: [...Array(10)].map((_, i) => [`탄소중립 긍정 기사 ${i + 1}`, `친환경 정책 성과 설명 ${i + 1}`]),
    negative: [...Array(10)].map((_, i) => [`기후위기 부정 기사 ${i + 1}`, `환경 위협 설명 ${i + 1}`])
  },
  'AI': {
    positive: [...Array(10)].map((_, i) => [`AI 혁신 긍정 기사 ${i + 1}`, `AI 장점 설명 ${i + 1}`]),
    negative: [...Array(10)].map((_, i) => [`AI 부작용 기사 ${i + 1}`, `AI 우려 설명 ${i + 1}`])
  },
  '연예인': {
    positive: [...Array(10)].map((_, i) => [`연예인 선행 기사 ${i + 1}`, `호감 행보 설명 ${i + 1}`]),
    negative: [...Array(10)].map((_, i) => [`연예인 논란 기사 ${i + 1}`, `논란 상세 설명 ${i + 1}`])
  }
};
let truePos = 0, trueNeg = 0, userPos = 0, userNeg = 0;
const $ = id => document.getElementById(id);
$('generate').onclick = generateFeed;
$('result-btn').onclick = showResult;

function generateFeed() {
  const topic = $('topic-select').value;
  const pool = FEEDS[topic];
  const combined = [
    ...pool.positive.map(([t, d]) => ({ title: t, desc: d, type: 'positive' })),
    ...pool.negative.map(([t, d]) => ({ title: t, desc: d, type: 'negative' }))
  ].sort(() => Math.random() - 0.5);
  const list = combined.slice(0, 10);
  truePos = list.filter(x => x.type === 'positive').length;
  trueNeg = 10 - truePos;
  userPos = userNeg = 0;
  const feed = $('feed');
  feed.innerHTML = '';
  list.forEach((item, idx) => {
    const card = document.createElement('div');
    card.className = 'feed-item';
    card.dataset.state = 'none';

    const title = document.createElement('p');
    title.textContent = `${idx + 1}. ${item.title}`;
    const desc = document.createElement('div');
    desc.className = 'subtext';
    desc.textContent = item.desc;

    const actions = document.createElement('div');
    actions.className = 'tag-buttons';
    ['긍정', '부정'].forEach(lbl => {
      const btn = document.createElement('button');
      btn.textContent = lbl;
      btn.className = 'tag-button';
      btn.onclick = () => tag(card, lbl === '긍정' ? 'positive' : 'negative');
      actions.appendChild(btn);
    });

    card.appendChild(title);
    card.appendChild(desc);
    card.appendChild(actions);
    feed.appendChild(card);
  });
  $('result-btn').classList.remove('hidden');
  $('summary').classList.add('hidden');
  $('explanation').classList.add('hidden');
  $('survey').classList.add('hidden');
}

function tag(card, state) {
  const prev = card.dataset.state;
  if (prev === state) return;
  if (prev === 'positive') userPos--; if (prev === 'negative') userNeg--;
  if (state === 'positive') {
    userPos++;
    card.classList.add('positive');
    card.classList.remove('negative');
  } else {
    userNeg++;
    card.classList.add('negative');
    card.classList.remove('positive');
  }
  card.dataset.state = state;
}

function showResult() {
  if (userPos + userNeg < 10) {
    alert('모든 기사에 라벨을 지정해주세요');
    return;
  }
  $('real').textContent = `실제 비율: 긍정 ${truePos} / 부정 ${trueNeg}`;
  $('user').textContent = `당신의 라벨: 긍정 ${userPos} / 부정 ${userNeg}`;
  $('summary').classList.remove('hidden');
  $('summary').scrollIntoView({ behavior: 'smooth' });
}

function showExplanation() {
  $('explanation').classList.remove('hidden');
  $('explanation').scrollIntoView({ behavior: 'smooth' });
}

function showSurvey() {
  $('survey').classList.remove('hidden');
  $('survey').scrollIntoView({ behavior: 'smooth' });
}

function submitSurvey() {
  const feedback = $('thoughts').value.trim();
  if (!feedback) {
    alert('내용을 입력해주세요.');
    return;
  }
  // 서버로 전송
  fetch('https://your-server-endpoint.com/submit-feedback', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ feedback, topic: $('topic-select').value, userPos, userNeg, truePos, trueNeg })
  })
  .then(res => res.ok ? res.json() : Promise.reject(res.statusText))
  .then(() => {
    alert('제출이 완료되었습니다. 감사합니다!');
    $('survey').innerHTML = '<h3>제출 감사합니다!</h3><p>여러분의 의견이 반영될 수 있도록 노력하겠습니다.</p>';
  })
  .catch(err => {
    console.error('서버 전송 오류:', err);
    alert('제출 중 오류가 발생했습니다. 다시 시도해주세요.');
  });
}
</script>
</body>
</html>
